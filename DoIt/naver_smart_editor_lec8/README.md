## 스레드

## AsyncTask 사용하기



| 메소드 이름 | 설명 |
| ---| ---|
|doInBackground() | 새로 만들어진 스레드에서 백그라운드 작업을 수행한다. execute() 메소드를 호출할 때 사용된 파라미터를 배열로 전달받는다.|
|onPreExecute()|백그라운드 작업을 수행하기 전에 호출된다. 메인 스레드에서 실행되며 초기화 작업에 사용된다.|
|onProgressUpdate()|백그라운드 작업의 진행상태를 표시하기 위해 호출된다. 작업 수행 중간 중간에 UI 객체에 접근하는 경우에 사용된다. 이 메소드가 호출되도록 하려면 백그라운드 작업 중간에 publishProgress() 메소드를 호출해야 한다.|
|onPostExecure()|백그라운드 작업이 끝난 후에 호출된다. 메인 스레드에서 실행되며 메모리 리소스를 해제하는 등의 작업에 사용된다. 백그라운드 작업의 결과는 Result 타입의 파라미터로 전달된다.|

AsyncTask 객체의 cancel() 메소드를 호출하면 작업을 취소할 수 있는데, 이 메소드를 통해 작업을 취소했을 경우에는 onCancelled() 메소드가 호출된다. 작업의 진행 상황을 확인하고 싶은 경우에는 AsyncTask() 객체의 getStatus() 메소드를 사용할 수 있다.

리턴되는 상태는 PENDING, RUNNING, FINISHED가 있다.



## 소켓 사용하기

HTTP 프로토콜은 소켓으로 연결한 후에 웹서버로 요청을 전송하고 응답을 받는 과정을 거치게 되는데 일반적으로는 응답을 받고난 후 연결을 끊게 된다.
비연결성(Statless)으로 불리는 이런 특성으로 인해 실시간으로 데이터를 처리하는 애플리케이션의 경우 응답속도를 높이기 위해 HTTP보다는 소켓 연결을 선호한다.

안드로이드에서는 소켓 연결을 시도하거나 응답을 받아 처리할 때 스레드를 사용해야 한다. 과거에는 권장 사항이였으나, 최근 플렛폼에서는 강제 사항이 되었다.

--
## 웹으로 요청

비연결성(Stateless)인 HTTP 프로토콜은 페이지 정보를 요청할 때마다 내부적으로 소켓 연결을 새로 하고 응답을 받은 후 연결을 끊어버리므로 새로 연결을 만드는데 지연시간이 훨씬 더 길이지곤 했다.

HTTP를 이용해 웹 서버에 접속하는 것도 소켓의 경우와 마찬가지로 표준 자바의 방식을 그대로 사용할 수 있다.

URL 객체를 만들고 이 객체의 openConnection() 메소드를 호출하여 HttpURLConnection 객체를 이용해 연결할 경우에는 'GET'이나 'POST'와 같은 요청 방식과 함께 요청을 위한 파라미터들을 설정할 수 있다.

	public void setRequestMethod(String method)
	public void setRequestProperty(String field, String newValue)
    
요청 방식을 지정하는 메소드는 setRequestMethod()로 'GET'이나 'POST' 문자열을 파라미터로 전달한다. setRequestProperty() 메소드는 요청할 때 헤더에 들어가는 필드 값을 지정할 수 있도록 한다.

openConnection() 메소드 호출하면 HttpURLConnection 객체가 리턴된다. 이 객체에 GET 방식으로 요청한다는 내용을
setRequestMethod()를 이용해 설정하고 getResponseCode()메소드를 호출하면 이 시점에 내부적으로 웹 서버에 페이지를 요청하는 과정을 수행하게 된다.

setConnectionTimeout() 메소드는 연결 대기 시간을 설정하는 것으로 10초 동안 연결되기를 기다린다는 의미이며, setDoInput()과 setDoOutput() 메소드는 이 객체의 입력과 출력이 가능하도록 만들어준다. 응답코드가 HTTP_OK인 경우에는 정상적으로 응답이 온 경우이며, 이 경우 응답으로 들어온 스트림을 문자열로 반환하여 리턴한ㄷ. 만약 요청한 주소의 페이지가 없는 경우에는 HTTP_NOT_FOUND 코드가 리턴되며 이 외에도 다양한 응답 코드가 정의되어 있다.

스트림을 한 줄씩 읽어들이는 메소드은 readLin()은 BufferReader 클래스에 정의되어 있으므로 HttpURLConnection 객체의 스트림을 이 클래스의 객체로 만든 후에 처리한다.




안드로이드는 좀 더 다양한 기능을 제공하는 아파치(Apache)라이브러리를 이용해 처리하던 HTTP 요청 코드를 그대로 사용할 수 있다.

---

RSS란?

'Really Simple Syndication'으로 표현하거나 때로는 'Rich Site Summary'로 표현하는데 자주 바뀌는 내용을 제공하기 위해 사용되는 표준 웹 피드(Feed) 포맷이다.

웹사이트 간에 자료를 교환하거나 배급하기 위한 XML(확장성 생성 언어) 기반의 포맷을 말한다. 뉴스·날씨·쇼핑·블로그 등 업데이트가 빈번히 이루어지는 웹사이트에서 업데이트된 정보를 사용자들에게 자동적으로 간편하게 제공하기 위한 방편으로 이용된다.


RSS 문서의 소스를 보면 XML로 되어있기 때문에 그 내용을 파싱한 후 화면에 보여주면 된다.

XML을 파싱하는 방법은 여러가지가 있으나 대표적으로 DOM(Document Object Model)과 SAX(Simple API for XML) 파서가 있다.

- DOM 파서는 XML문서 전체를 읽어들인 후 각각의 태그 정보를 사용하는 방식이고 SAX 파서는 읽어들인 태그정보만 있으면 필요한 만큼 부분적으로 처리할 수 있는 방식으로 각각 장단점이 있다. 보통 문서 양이 많거나 내용이 순차적으로 구성된 경우에는 빠른 처리가 가능한 SAX 파서를 많이 이용한다.

SAX 파서 : 문서 내용을 순차적으로 읽어 들이면서 각각의 노드들을 파악해 나가는 방식을 사용한다. 원격 데이터베이스에 있는 내용을 동적으로 처리하거나 용량이 큰 문서를 처리하는 데는 SAX 파서가 좋다.

DOM 파서 : 전체 문서를 읽어 들인 후 전체 노드들 중에서 필요한 노드를 찾아 처리할 수 있다. 작은 용량의 문서를 구조화하여 처리하는 데는 DOM 파서가 더 직관적이고 간단할 수 있다.

DOM 파서를 이용해 RSS문서를 파싱하기 위해서는 HTTP 프로토콜로 문서를 요청한 후 파서에서 응답으로 온 스트림을 처리하므로 SAX 파서를 사용할 때와 마찬가지 방식으로 서버에 요청하게 된다.

RSS문서를 DOM 파서를 이용해 파싱하게 되면 다음과 같은 정보를 확인할 수 있다.

|노드 이름|설명|
|---|---|
|Document|DOM 문서를 나타내는 최상위 노드|
|Element|문서 안에 들어있는 태그를 나타내는 노드|
|Attr|태그의 속성값|








